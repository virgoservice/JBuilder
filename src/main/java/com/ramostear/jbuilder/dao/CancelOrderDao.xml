<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ramostear.jbuilder.dao.CancelOrderDao">
		
	<resultMap type="com.ramostear.jbuilder.entity.CancelOrder" id="resultMap">
		<id column="id" property="id"/>
		<result column="cancelOrderCode" property="cancelOrderCode"/>
		<result column="orderId" property="orderId"/>
		<result column="childOrderId" property="childOrderId"/>
		<result column="retreatBatchNo" property="retreatBatchNo"/>
		<result column="num" property="num"/>
		<result column="status" property="status"/>
		<result column="cancelDate" property="cancelDate"/>
		<result column="checkDate" property="checkDate"/>
		<result column="checkMan" property="checkMan"/>
		
		<result column="result" property="result"/>
		<result column="totalPrice" property="totalPrice"/>
		
		<association property="child" column="childOrderId" select="findOrder"/>
		<association property="order" column="orderId" select="findOrder2"/>
	</resultMap>
	
	<insert id="save" parameterType="com.ramostear.jbuilder.entity.CancelOrder" useGeneratedKeys="true" keyColumn="id" keyProperty="id">
		insert into order_cancel_order
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="cancelOrderCode != null">cancelOrderCode,</if>
			<if test="orderId != null">orderId,</if>
			<if test="childOrderId != null">childOrderId,</if>
			<if test="retreatBatchNo != null">retreatBatchNo,</if>
			<if test="num != null">num,</if>
			<if test="status != null">status,</if>
			<if test="totalPrice != null">totalPrice,</if>
			<if test="result != null">result,</if>
			<if test="checkDate != null">checkDate,</if>
			<if test="checkMan != null">checkMan,</if>
			
			<if test="cancelDate != null">cancelDate</if>
		</trim>
		<trim prefix="values(" suffix=")" suffixOverrides=",">
			<if test="cancelOrderCode != null">#{cancelOrderCode},</if>
			<if test="orderId != null">#{orderId},</if>
			<if test="childOrderId != null">#{childOrderId},</if>
			<if test="retreatBatchNo != null">#{retreatBatchNo},</if>
			<if test="num != null">#{num},</if>
			<if test="status != null">#{status},</if>
			<if test="totalPrice != null">#{totalPrice},</if>
			<if test="result != null">#{result},</if>
			<if test="checkDate != null">#{checkDate},</if>
			<if test="checkMan != null">#{checkMan},</if>
			<if test="cancelDate != null">#{cancelDate}</if>
		</trim>
	</insert>	
	
	<update id="update" parameterType="com.ramostear.jbuilder.entity.CancelOrder">
		update order_cancel_order
		<set>
			<if test="cancelOrderCode != null">cancelOrderCode=#{cancelOrderCode},</if>
			<if test="orderId != null">orderId=#{orderId},</if>
			<if test="childOrderId != null">childOrderId=#{childOrderId},</if>
			<if test="retreatBatchNo != null">retreatBatchNo=#{retreatBatchNo},</if>
			<if test="num != null">num=#{num},</if>
			<if test="status != null">status=#{status},</if>
			<if test="result != null">result=#{result},</if>
			<if test="totalPrice != null">totalPrice=#{totalPrice},</if>
			<if test="checkDate != null">checkDate=#{checkDate},</if>
			<if test="checkMan != null">checkMan=#{checkMan},</if>
			<if test="cancelDate != null">cancelDate=#{cancelDate}</if>
		</set>
		where id = #{id}
	</update>
	
	<select id="size" resultType="Long">
		select count(*) from order_cancel_order
	</select>
	
	
	<delete id="delete" parameterType="Long">
		delete from order_cancel_order 
		where 
		id = #{id}
	</delete>

	<select id="findById" parameterType="Long" resultMap="resultMap">
		select * from order_cancel_order 
		where 
		id = #{id}
	</select>
	
	<select id="findByOrderCode" parameterType="String" resultMap="resultMap">
		select * from order_cancel_order 
		where 
		CancelOrderCode = #{orderCode}
	</select>
	
	<select id="findByRetreatBatchNo" parameterType="String" resultMap="resultMap">
		select * from order_cancel_order 
		where 
		retreatBatchNo = #{retreatBatchNo}
	</select>
	
	<select id="findCancelCount"  parameterType="Long"  resultType="Long">
		select sum(t.num) from 
		order_cancel_order t 
		where t.childOrderId=#{id}
 
	</select>
	
	<select id="findCancelResult"  parameterType="Long"  resultType="Long">
		select sum(t.num) from 
		order_cancel_order t 
		where t.childOrderId=#{id}
		and result=1
 
	</select>
	
	<select id="findAll"  resultMap="resultMap">
		select * from order_cancel_order
	</select>
	<select id="findByPage" resultMap="resultMap">
		select * from order_cancel_order where 1=1
		<if test="status != null and status !=''">
			and status = ${status}
		</if>
		<if test="orderCode != null and orderCode !=''">
			and orderId in ( select id from order_order where orderCode like '%${orderCode}%')
		</if>
		<if test="cancelOrderCode != null and cancelOrderCode !=''">
			and cancelOrderCode like '%${cancelOrderCode}%' 
		</if>
		
		order by ${orderBy} 
		<if test="order == true">
			DESC
		</if>
		<if test="order == false">
			ASC
		</if>
		limit #{offset},#{size}
	</select>
	
	<select id="findOrder" parameterType="Long" resultType="com.ramostear.jbuilder.entity.OrderChild">
		select * from order_order_child
		where 
		id = #{id}
	</select>
	
	<select id="findOrder2" parameterType="Long" resultType="com.ramostear.jbuilder.entity.Order">
		select * from order_order
		where 
		id = #{id}
	</select>
	
</mapper>